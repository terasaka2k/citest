machine:
  environment:
    HAS_NO_DIFF: 0
dependencies:
  cache_directories:
    - mycache
  pre:
    - test -d mycache && [ $HAS_NO_DIFF == 1 ] && touch SKIP_DEPS || echo "Has diff"

    - test -f SKIP_DEPS || touch INST_DEPS

    - >-
      test -f SKIP_DEPS
      || echo "Removing dependencies cache"
      && rm -rf mycache && mkdir mycache
  override:
    - >-
      test -f INST_DEPS
      || echo "Skipping dependencies installation"
      && echo "Copying dependencies"
      && cp -ra mycache/node_modules .
    - >-
      test -f SKIP_DEPS
      || echo "Installing dependencies"
      && npm i xtend
      && cp -ra node_modules mycache/

test:
  override:
    - ls
    - /bin/true

deployment:
  lab:
    branch: lab
    commands:
      - echo "Deploying"
